on:
  push:
    # Sequence of patterns matched against refs/tags
    tags:
    - 'rs-v*' # Push events to matching v*, i.e. v1.0, v20.15.10

name: Publish Rust Release Asset

jobs:
  publish:
    name: Cargo Publish and GH Release
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - uses: Swatinem/rust-cache@v1
      - name: Run Publish
        run: cargo publish --verbose
        
      - name: Run Build
        run: cargo build --release
        
      - name: Upload Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: |
            .\target\release\PowerSession.exe
        env:
          TOKEN: ${{ secrets.GITHUB_TOKEN }}

env:
  CARGO_TERM_COLOR: always
  CARGO_REGISTRY_TOKEN: ${{ secrets.CRATES_IO_TOKEN }}
